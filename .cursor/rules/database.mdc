---
description: 
globs: internal/**/database/*.go
alwaysApply: false
---
# Database Guidelines

This project uses PostgreSQL with GORM for database operations. See [internal/infrastructure/database/gorm.go](mdc:goforms/internal/infrastructure/database/gorm.go) for implementation details.

## Core Components

1. **Database Connection**
   - Uses GORM with PostgreSQL
   - Implements connection pooling
   - Configures prepared statements
   - Includes query logging

2. **Store Implementation**
   - Uses repository pattern
   - Implements context-aware operations
   - Handles domain errors
   - Uses GORM's query builder

## Best Practices

1. **Context Usage**
   ```go
   // Always use context-aware methods
   db.WithContext(ctx).First(&user)
   db.WithContext(ctx).Create(&user)
   db.WithContext(ctx).Updates(&user)
   ```

2. **Error Handling**
   ```go
   if errors.Is(err, gorm.ErrRecordNotFound) {
       return nil, domain.ErrNotFound
   }
   ```

3. **Model Organization**
   ```go
   type User struct {
       gorm.Model
       Email    string `gorm:"uniqueIndex;not null" validate:"required,email"`
       Password string `gorm:"not null" validate:"required"`
   }
   ```

## GORM Features

1. **Hooks**
   - BeforeCreate
   - AfterCreate
   - BeforeUpdate
   - AfterUpdate
   - BeforeDelete
   - AfterDelete

2. **Query Builder**
   - Where conditions
   - Joins
   - Preloading
   - Scopes
